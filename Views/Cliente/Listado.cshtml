
@{
    ViewBag.Title = "Listado";
}

<h1>Clientes</h1>
<div class="table-responsive mt-2">
    <table id="tablaClientes" class="table table-bordered table-striped">
        <thead class="thead-dark text-center">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Nombre</th>
                <th scope="col">DUI</th>
                <th scope="col">Télefono</th>
                <th scope="col">Acciones</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

@section scripts{

    <script>
        var tablaClientes = function (datos) {
            var tabla = $('#tablaClientes').DataTable({
                language: spanishTranslationConfig,
                data: datos,
                columns: [
                    { data: "id" },
                    { data: "nombreCompleto" },
                    { data: "dui" },
                    { data: "telefono" },
                    {
                        defaultContent:
                            "<div class='text-center'>" +
                            "<a class='editar btn btn-primary mx-1' title='Actualizar' href='#'><i class='fa fa-pencil'></i></a>" +
                            "<a class='borrar btn btn-danger mx-1' title='Eliminar' href='#'><i class='fa fa-trash'></i></a>" +
                            "</div>"
                    }
                ]
            });
        };

        var llenarTabla = function () {
            var url = '@Url.Content("~/Cliente/ListadoJson")';

            $.get(url, function (data) {
                tablaClientes(data);
            }).fail(function (error) {
                alert("Ocurrio un error en el servidor. Detalle del error: " + error);
            });
        };

        $(document).ready(function () {
            // llamamos la funcion para recuperar listado de clientes y llenar la tabla
            llenarTabla();

            // evento para boton editar
            $("#tablaClientes tbody").on("click", "a.editar", function () {
                var data = $('#tablaClientes').DataTable().row($(this).parents("tr")).data();
                var idCliente = data.id;
                console.log(idCliente);
            });

            // evento para boton editar
            $("#tablaClientes tbody").on("click", "a.borrar", function () {
                var data = $('#tablaClientes').DataTable().row($(this).parents("tr")).data();
                var idCliente = data.id;
                var nombreCliente = data.nombreCompleto;
                if (confirm("Seguro que desea eliminar al cliente " + nombreCliente)) {
                    console.log(idCliente);
                    alert("Eliminado");
                }
            });
        });
    </script>
}
